<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lost.customMapper.DetFoundMapper">

	<!-- found共同sql语句 -->
	<sql id="Common_List">
		tf.id,tc.category_name AS categoryName,
		tu.username AS userName,
		tf.found_place AS foundPlace,
		tf.contacts,tf.email,
		tf.description,tf.infoTitle,
		tf.found_time AS foundTime1,
		tf.updated
	</sql>

	<!-- 查询所有明细失物 -->
	<select id="selectAllDetailFound" resultType="com.lost.customPojo.DetFound">
		SELECT
			<include refid="Common_List" />
		FROM
			tb_found AS tf
			INNER JOIN tb_category AS tc ON tf.category_id = tc.id
			INNER JOIN tb_users AS tu ON tf.user_id = tu.id
		ORDER BY tf.updated DESC
	</select>
	
	<!-- 按条件分页查询所有明细失物 -->
	<select id="selectConditionFound" resultType="com.lost.customPojo.DetFound" parameterType="com.lost.customPojo.DetFound">
		SELECT
			<include refid="Common_List" />
		FROM
			tb_found AS tf
			INNER JOIN tb_users AS tu ON tf.user_id = tu.id
			INNER JOIN (
				SELECT
					id,category_name
				FROM
					tb_category
				<where>
					<if test="categoryName != null">
						 category_name = #{categoryName,jdbcType=VARCHAR}
					</if>
				</where>
			) AS tc ON tf.category_id = tc.id
		<where>
			<if test="foundPlace != null">
					tf.found_place LIKE "%"#{foundPlace,jdbcType=VARCHAR}"%"
			</if>
			<if test="foundTime1 != null and foundTime2 != null">
					AND tf.found_time BETWEEN #{foundTime1,jdbcType=TIMESTAMP} AND #{foundTime2,jdbcType=TIMESTAMP}
			</if>
		</where>
		ORDER BY tf.updated DESC
	</select>

</mapper>